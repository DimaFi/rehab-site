{{ define "main" }}
<section class="reviews-page container" style="padding: 40px 0;">
  <h1 class="section-title" style="margin-bottom: 20px;">–û—Ç–∑—ã–≤—ã –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</h1>

  {{/* –ú–∏–Ω–∏-–æ—Ç–∑—ã–≤—ã (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ 9 –ø–æ —Ç–µ–º–∞–º) */}}
  {{ partial "mini-reviews.html" . }}

  {{/* –§–∏–ª—å—Ç—Ä –æ—Ç–∑—ã–≤–æ–≤ */}}
  <div class="reviews-filter" style="margin: 30px 0; display: flex; gap: 10px; flex-wrap: wrap;">
    <button class="filter-btn active" data-filter="all">–í—Å–µ</button>
    <button class="filter-btn" data-filter="–∞–ª–∫–æ–≥–æ–ª–∏–∑–º">–ê–ª–∫–æ–≥–æ–ª–∏–∑–º</button>
    <button class="filter-btn" data-filter="–Ω–∞—Ä–∫–æ–º–∞–Ω–∏—è">–ù–∞—Ä–∫–æ–º–∞–Ω–∏—è</button>
    <button class="filter-btn" data-filter="—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è">–†–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è</button>
    <button class="filter-btn" data-filter="–¥–µ—Ç–æ–∫—Å">–î–µ—Ç–æ–∫—Å</button>
    <button class="filter-btn" data-filter="—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏">–†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º</button>
  </div>

  <div class="reviews-list">
    {{ $pages := .Pages.ByDate.Reverse }}
    {{ range $pages }}
      {{ $category := "–∞–ª–∫–æ–≥–æ–ª–∏–∑–º" }}
      {{ if in .Params.tags "–Ω–∞—Ä–∫–æ–º–∞–Ω–∏—è" }}{{ $category = "–Ω–∞—Ä–∫–æ–º–∞–Ω–∏—è" }}{{ end }}
      {{ if in .Params.tags "—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è" }}{{ $category = "—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è" }}{{ end }}
      {{ if in .Params.tags "–¥–µ—Ç–æ–∫—Å–∏–∫–∞—Ü–∏—è" }}{{ $category = "–¥–µ—Ç–æ–∫—Å" }}{{ end }}
      {{ if in .Params.tags "—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏" }}{{ $category = "—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏" }}{{ end }}
      {{ if .Params.category }}{{ $category = .Params.category }}{{ end }}
      <article class="review-item" data-category="{{ $category }}">
        <div class="review-head">
          <div class="review-avatar">
            {{ if .Params.avatar }}
              <img src="{{ .Params.avatar }}" alt="–ê–≤–∞—Ç–∞—Ä" loading="lazy" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<div class=\\'avatar-placeholder\\'>üë§</div>';" />
            {{ else }}
              <div class="avatar-placeholder">üë§</div>
            {{ end }}
          </div>
          <div class="review-meta">
            <h2 class="review-title">{{ if .Title }}{{ .Title }}{{ else }}–ê–Ω–æ–Ω–∏–º–Ω–æ{{ end }}</h2>
            {{ with .Date }}<time class="review-date" datetime="{{ .Format "2006-01-02" }}">{{ .Format "02.01.2006" }}</time>{{ end }}
          </div>
          {{ $hasDetail := or (.Params.detail) (.Params.has_detail) }}
          {{ if $hasDetail }}
            <a class="review-expand" href="{{ .RelPermalink }}" aria-label="–ü–æ–ª–Ω–∞—è –≤–µ—Ä—Å–∏—è –æ—Ç–∑—ã–≤–∞">+</a>
          {{ end }}
        </div>
        <div class="review-text clamp-6">
          {{ if .Summary }}
            {{ .Summary | safeHTML }}
          {{ else }}
            {{ .Plain | truncate 600 }}
          {{ end }}
        </div>
      </article>
    {{ end }}
  </div>
</section>

<script>
// –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –æ—Ç–∑—ã–≤–æ–≤
document.addEventListener('DOMContentLoaded', function() {
    const filterButtons = document.querySelectorAll('.reviews-filter .filter-btn, .mini-filter .mini-btn');
    const reviewItems = document.querySelectorAll('.review-item');
    
    if (!filterButtons.length || !reviewItems.length) return;
    
    filterButtons.forEach(function(button) {
        if (button.tagName === 'A') return;
        
        button.addEventListener('click', function(e) {
            e.preventDefault();
            
            // –£–±–∏—Ä–∞–µ–º active —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            filterButtons.forEach(function(btn) {
                if (btn.tagName === 'BUTTON') {
                    btn.classList.remove('active');
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º active –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
            this.classList.add('active');
            
            // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞
            const filter = this.getAttribute('data-filter') || this.getAttribute('data-topic');
            
            // –§–∏–ª—å—Ç—Ä—É–µ–º –æ—Ç–∑—ã–≤—ã
            reviewItems.forEach(function(item) {
                const category = item.getAttribute('data-category');
                let shouldShow = false;
                
                if (!filter || filter === 'all') {
                    shouldShow = true;
                } else if (category && category.toLowerCase() === filter.toLowerCase()) {
                    shouldShow = true;
                } else if (filter === '–¥–µ—Ç–æ–∫—Å' && category === '–¥–µ—Ç–æ–∫—Å') {
                    shouldShow = true;
                } else if (filter === '—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è' && category === '—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è') {
                    shouldShow = true;
                } else if (filter === '—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏' && category === '—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏') {
                    shouldShow = true;
                }
                
                if (shouldShow) {
                    item.style.display = '';
                    item.style.opacity = '1';
                } else {
                    item.style.opacity = '0';
                    setTimeout(function() {
                        item.style.display = 'none';
                    }, 300);
                }
            });
        });
    });
});
</script>
{{ end }}
